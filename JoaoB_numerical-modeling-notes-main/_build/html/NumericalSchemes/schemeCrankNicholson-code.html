
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The Crank-Nicholson Scheme &#8212; Numerical Modeling Lecture Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Implicit Scheme" href="schemeImplicit.html" />
    <link rel="prev" title="The MacCormack Scheme" href="schemeMacCormack.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Numerical Modeling Lecture Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to the Numerical Modeling Lecture Notes
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../FiniteDifferences/Introduction.html">
   The finite difference method (FDM)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../FiniteDifferences/algebraicDerivative.html">
     Algebraic approximation of the first derivative
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../FiniteDifferences/truncationErrors.html">
     Truncation Error
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../FiniteDifferences/estimatesTruncationError.html">
     Estimates of the truncation error
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../FiniteDifferences/fdFormulasFirstDerivative.html">
     Finite difference formulas for the 1st derivative
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../FiniteDifferences/evaluatingTruncationError.html">
     Evaluating the truncation error
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../LinearAdvectionEquation/Introduction.html">
   The linear advection equation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../LinearAdvectionEquation/analyticSolution.html">
     The exact equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../LinearAdvectionEquation/differenceEquation.html">
     The difference equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../LinearAdvectionEquation/differenceSolution.html">
     Solution of the difference equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../LinearAdvectionEquation/Analysis.html">
     Analysis of the solution of the difference equation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../NumericalStability/intro.html">
   Stability of numerical schemes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumericalStability/vonNeumannStability.html">
     Von Neumann Stability Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../NumericalStability/matrixStability.html">
     Matrix Stability Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro.html">
   Numerical schemes for the linear 1-d advection equation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="schemeLeapfrog-code.html">
     The Leapfrog Scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="schemeUpwind-code.html">
     The Upwind Scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="schemeLaxWendroff-code.html">
     The Lax-Wendroff Scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="schemeMacCormack.html">
     The MacCormack Scheme
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The Crank-Nicholson Scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="schemeImplicit.html">
     The Implicit Scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="TVD.html">
     Total Variation Diminishing Schemes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="semiLagrangian.html">
     The semi-lagrangian scheme
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="semiLagrangianStability.html">
     Stability of semi-lagragian schemes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="twoDimensionalAdvection.html">
     The two dimensional advection equation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../TheWaveEquation/Introduction.html">
   Gravity Waves
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../TheWaveEquation/linear1dGravityWaves.html">
     Linear 1-d Gravity Waves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TheWaveEquation/solutionRegularGrid.html">
     Solution on a regular grid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TheWaveEquation/solutionStaggeredGrid.html">
     Solution on a staggered grid
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Bibliography/bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/NumericalSchemes/schemeCrankNicholson-code.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FNumericalSchemes/schemeCrankNicholson-code.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/NumericalSchemes/schemeCrankNicholson-code.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/NumericalSchemes/schemeCrankNicholson-code.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#consistency-stability-and-convergence">
   Consistency, stability and convergence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-propagation-of-top-hat-function">
   Application: propagation of top hat function
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>The Crank-Nicholson Scheme</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#consistency-stability-and-convergence">
   Consistency, stability and convergence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-propagation-of-top-hat-function">
   Application: propagation of top hat function
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="the-crank-nicholson-scheme">
<span id="scheme-crank-nicholson"></span><h1>The Crank-Nicholson Scheme<a class="headerlink" href="#the-crank-nicholson-scheme" title="Permalink to this headline">#</a></h1>
<p>Until now, all schemes have time step limitations in the form of the CFL condition <span class="math notranslate nohighlight">\(c\Delta t/\Delta x \leq 1\)</span>. One way to overcome that limitation is to use <em>implicit</em> schemes, where the spatial derivatives are evaluated at <span class="math notranslate nohighlight">\(t^{n+1}\)</span>. One such scheme is the Crank-Nicholson scheme:</p>
<div class="math notranslate nohighlight" id="equation-eq-schemecranknicholson">
<span class="eqno">(53)<a class="headerlink" href="#equation-eq-schemecranknicholson" title="Permalink to this equation">#</a></span>\[
  \frac{u_m^{n+1}-u_m^n}{\Delta t} = -\frac{c}{2}\left(\frac{u_{m+1}^{n+1}-u_{m-1}^{n+1}}{2\Delta x} + \frac{u_{m+1}^{n}-u_{m-1}^{n}}{2\Delta x}\right)
\]</div>
<p>The scheme uses a forward approximation to the time derivative at <span class="math notranslate nohighlight">\(t^n\)</span> and the average of the centred approximations of the space derivative at <span class="math notranslate nohighlight">\(t^n\)</span> and <span class="math notranslate nohighlight">\(t^{n+1}\)</span>.</p>
<p>Another way of looking at <a class="reference internal" href="#equation-eq-schemecranknicholson">(53)</a> is that the LHS is a centred approximation of the time derivative at <span class="math notranslate nohighlight">\(t^{n+1/2}\)</span> and the averaging of the spatial derivatives provides an estimate of the spatial derivative at <span class="math notranslate nohighlight">\(t^{n+1/2}\)</span>.</p>
<p>The use of the terms at <span class="math notranslate nohighlight">\(t^{n+1}\)</span> poses a complication because these are not known at time <span class="math notranslate nohighlight">\(t^n\)</span>. Therefore, the scheme is not an explicit time marching scheme as we have seen so far, but one where the solution is implicit in the scheme itself, hence the designation of <em>implicit</em> scheme. To obtain the unknown values at <span class="math notranslate nohighlight">\(t^{n+1}\)</span>, a linear system of equations must be solved.</p>
<p>We can expand <a class="reference internal" href="#equation-eq-schemecranknicholson">(53)</a> to obtain</p>
<div class="math notranslate nohighlight">
\[
  -\frac{\sigma}{4}u_{m-1}^{n+1}  + u_m^{n+1} + \frac{\sigma}{4}u_{m+1}^{n+1} =
    \frac{\sigma}{4}u_{m-1}^{n}  + u_m^{n} - \frac{\sigma}{4}u_{m+1}^{n},\quad \sigma = c\frac{\Delta t}{\Delta x}   
\]</div>
<p>that is a linear system of equations</p>
<div class="math notranslate nohighlight" id="equation-eq-schemeab">
<span class="eqno">(54)<a class="headerlink" href="#equation-eq-schemeab" title="Permalink to this equation">#</a></span>\[
  A\mathbf{u}^{n+1}=B\mathbf{u}^{n}.
\]</div>
<p>The matrices <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span>, are in the case of Dirichlet boundary conditions <span class="math notranslate nohighlight">\(u(0,t)=u(L,t)=0\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
A = 
\begin{pmatrix}
  1                        &amp; \frac{\sigma}{4}   &amp; 0                             &amp;         0                &amp; \cdots &amp; 0\\
  -\frac{\sigma}{4} &amp; 1                         &amp; \frac{\sigma}{4}       &amp;         0                &amp; \cdots &amp; 0\\
                          0 &amp; -\frac{\sigma}{4} &amp; 1                              &amp; \frac{\sigma}{4} &amp; \cdots &amp; 0\\
            \vdots       &amp;          \vdots        &amp;   \vdots                     &amp; \ddots               &amp; \vdots  &amp; \vdots\\
            0               &amp;              \cdots           &amp;            0             &amp; -\frac{\sigma}{4} &amp; 1                         &amp; \frac{\sigma}{4} \\
         0               &amp;              \cdots           &amp;        0                 &amp; 0                 &amp;-\frac{\sigma}{4} &amp; 1                         \\
\end{pmatrix}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
B = 
\begin{pmatrix}
  1                        &amp; -\frac{\sigma}{4}   &amp; 0                             &amp;         0                &amp; \cdots &amp; 0\\
  \frac{\sigma}{4} &amp; 1                         &amp; -\frac{\sigma}{4}       &amp;         0                &amp; \cdots &amp; 0\\
                          0 &amp; \frac{\sigma}{4} &amp; 1                              &amp; -\frac{\sigma}{4} &amp; \cdots &amp; 0\\
            \vdots       &amp;          \vdots        &amp;   \vdots                     &amp; \ddots               &amp; \vdots  &amp; \vdots\\
            0               &amp;              \cdots           &amp;            0             &amp; \frac{\sigma}{4} &amp; 1                         &amp; -\frac{\sigma}{4} \\
         0               &amp;              \cdots           &amp;        0                 &amp; 0                 &amp;\frac{\sigma}{4} &amp; 1                         \\
\end{pmatrix}
\end{split}\]</div>
<p>In the case <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are tridiagonal, as above, the solution of the linear system <a class="reference internal" href="#equation-eq-schemeab">(54)</a> is expedite. In other cases, iterative methods must be used.</p>
<section id="consistency-stability-and-convergence">
<h2>Consistency, stability and convergence<a class="headerlink" href="#consistency-stability-and-convergence" title="Permalink to this headline">#</a></h2>
<p>The scheme has a truncation error <span class="math notranslate nohighlight">\(O(\Delta t^2,\Delta x^2)\)</span>, since the spatial derivatives are approximated by a centred formula and the time derivative also, at <span class="math notranslate nohighlight">\(t^{n+1/2}\)</span>.
The stability of the scheme can be determined by the usual method of assuming a solution of the form <span class="math notranslate nohighlight">\(B^n e^{i\lambda m \Delta x}\)</span> and noting that</p>
<div class="math notranslate nohighlight">
\[
    u_{m+1}^{n}-u_{m-1}^{n} = (2i\sin\lambda \Delta x)u_{m}^{n}
\]</div>
<p>we arrive at the following amplification factor:</p>
<div class="math notranslate nohighlight" id="equation-eq-ampfactorcn">
<span class="eqno">(55)<a class="headerlink" href="#equation-eq-ampfactorcn" title="Permalink to this equation">#</a></span>\[
   G = \frac{u_{m}^{n+1}}{u_{m}^{n}} = \frac{1-(\sigma/2)i\sin\lambda \Delta x}{1+(\sigma/2)i\sin\lambda \Delta x},
\]</div>
<p>whose norm <span class="math notranslate nohighlight">\(|G|\)</span> is</p>
<div class="math notranslate nohighlight">
\[
 |G| = \left| \frac{1-(\sigma/2)i\sin\lambda \Delta x}{1+(\sigma/2)i\sin\lambda \Delta x}\right| = 
    \frac{ \left|1-(\sigma/2)i\sin\lambda \Delta x\right|}{ \left|1+(\sigma/2)i\sin\lambda \Delta x\right|} = 1.
\]</div>
<p>The scheme is, therefore, <em>unconditionally stable</em> and doesn’t suffer from CFL limitations, unlike the previous explicit schemes.</p>
</section>
<section id="application-propagation-of-top-hat-function">
<h2>Application: propagation of top hat function<a class="headerlink" href="#application-propagation-of-top-hat-function" title="Permalink to this headline">#</a></h2>
<p>To test the scheme, we are going to apply it to the propagation of the top hat signal.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">topHat</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="n">f0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
   <span class="n">f0</span><span class="p">[(</span><span class="n">x</span><span class="o">&gt;</span><span class="mf">0.45</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">0.55</span><span class="p">)]</span><span class="o">=</span><span class="mi">1</span>

   <span class="k">return</span> <span class="n">f0</span>
</pre></div>
</div>
</div>
</div>
<p>The Crank-Nicholson scheme is implemented in the following Python function:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">crankNicholson</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>

    <span class="c1"># Initial condition</span>
    <span class="n">u</span><span class="o">=</span><span class="n">u0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># CFL number</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span>
    
    <span class="c1"># System of equations</span>
    
    <span class="c1"># Au^(n+1) = B*u^n</span>
    
    <span class="c1"># Fill matrices</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>

    <span class="n">r1</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">r2</span><span class="o">=</span><span class="n">alpha</span><span class="o">*</span><span class="n">C</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">M</span><span class="o">-</span><span class="mi">2</span><span class="p">,))</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">spdiags</span><span class="p">(</span> <span class="p">[</span><span class="o">-</span><span class="n">r2</span><span class="o">*</span><span class="n">ones</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">r2</span><span class="o">*</span><span class="n">ones</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">M</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="o">-</span><span class="mi">2</span> <span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">spdiags</span><span class="p">(</span> <span class="p">[</span><span class="n">r1</span><span class="o">*</span><span class="n">ones</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="o">-</span><span class="n">r1</span><span class="o">*</span><span class="n">ones</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">M</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">M</span><span class="o">-</span><span class="mi">2</span> <span class="p">)</span>
  
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        
        <span class="n">V</span><span class="o">=</span><span class="n">B</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">tocsc</span><span class="p">(),</span> <span class="n">V</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
<p>In the next code snippet, we set the discretization parameters and integrate the initial condition with the Crank-Nicholson scheme:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">spdiags</span>

<span class="n">N</span>     <span class="o">=</span> <span class="mi">30</span>       <span class="c1"># Number of time steps</span>
<span class="n">M</span>     <span class="o">=</span> <span class="mi">100</span>      <span class="c1"># Number of grid points</span>
<span class="n">c</span>     <span class="o">=</span> <span class="mf">0.75</span>     <span class="c1"># Propagation speed</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">M</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of time steps = </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of grid points = </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time step = </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grid size = </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CFL number = </span><span class="si">{:f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>

<span class="c1"># Grid points</span>
<span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>

<span class="c1"># Integrate the initial condition N time steps</span>
<span class="n">U</span><span class="o">=</span><span class="n">crankNicholson</span><span class="p">(</span><span class="n">topHat</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of time steps = 30
Number of grid points = 100
Time step = 0.010000
Grid size = 0.010000
CFL number = 0.750000
</pre></div>
</div>
</div>
</div>
<p>The solution at the end of the integration is shown below:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shift the exact solution a distance equivalent to c*N*dt</span>
<span class="n">newX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Crank-Nicholson&#39;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">topHat</span><span class="p">(</span><span class="n">newX</span><span class="p">),</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Crank-Nicholson Solution at t=</span><span class="si">{:5.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$u$&#39;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/schemeCrankNicholson-code_7_0.png" src="../_images/schemeCrankNicholson-code_7_0.png" />
</div>
</div>
<p>The unconditional stability of the implicit Crank-Nicholson scheme is its great advantage, but it’s use in the advection equation has unwanted consequences in the form of dispersion and errors in the phase speed. The comparison with the Leapfrog scheme shows that the scheme, although unconditionally stable still suffers from dispersive behaviour.</p>
<p>From <a class="reference internal" href="#equation-eq-ampfactorcn">(55)</a>, we can write</p>
<div class="math notranslate nohighlight">
\[
   \mathbf{u}^n = G\mathbf{u}^{n-1}= \dotso = G^{(n)} \mathbf{u}^0
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
   u_m^n = BG^{(n)} e^{i\lambda m\Delta x}
\]</div>
<p>Substituting <a class="reference internal" href="#equation-eq-ampfactorcn">(55)</a>, we obtain the following expression for the phase speed <span class="math notranslate nohighlight">\(c_F\)</span> of the numerical solution</p>
<div class="math notranslate nohighlight">
\[
  c_F = \frac{2\theta}{\lambda \Delta t}, \quad \theta = \tan^{-1}\left( \frac{\sigma}{2} \sin \lambda \Delta x \right)
\]</div>
<p>For shortwaves in the numerical solution, e.g. the <span class="math notranslate nohighlight">\(2\Delta x\)</span> wavelength, we have <span class="math notranslate nohighlight">\(\lambda = \pi/\Delta x\)</span> and <span class="math notranslate nohighlight">\(\theta = \tan^{-1} (\sigma/2 \sin \pi)=0\)</span>, which means the shortwave is stationary. For large wavelength, we have <span class="math notranslate nohighlight">\(\lambda \Delta x \ll 1\)</span> and</p>
<div class="math notranslate nohighlight">
\[
  \theta = \tan^{-1} {\frac{\sigma}{2} \sin \lambda \Delta x} = \tan^{-1} (\frac{c\lambda \Delta t}{2})
\]</div>
<p>For small <span class="math notranslate nohighlight">\(\Delta t\)</span>, we’ll have <span class="math notranslate nohighlight">\(\theta = \frac{c\lambda \Delta t}{2} \)</span> and <span class="math notranslate nohighlight">\(c_F = c\)</span>. But for large <span class="math notranslate nohighlight">\(\Delta t\)</span>, it will be <span class="math notranslate nohighlight">\(\theta = \pi/2\)</span> and <span class="math notranslate nohighlight">\(c_F = \pi/\Delta t \lambda\)</span>, which is independent of <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Therefore, either for shortwave components or long wavelengths we will have errors in the phase speed of the numerical solution that make the use of the Crank-Nicholson scheme dubious for the linear advection problem.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./NumericalSchemes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="schemeMacCormack.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The MacCormack Scheme</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="schemeImplicit.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Implicit Scheme</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Joao Bettencourt<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>